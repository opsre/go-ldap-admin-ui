$:
  tag_push:
    - runner:
        cpus: 8
      services:
        - docker
        - git-clone-yyds
      stages:
        - name: æ„å»ºç¼“å­˜é•œåƒ
          type: docker:cache
          options:
            dockerfile: .cache.dockerfile
            by:
              - package.json
              - package-lock.json
            versionBy:
              - package.json
          exports:
            name: DOCKER_CACHE_IMAGE_NAME
        - name: ç›´æ¥ä½¿ç”¨ç¼“å­˜é•œåƒç¯å¢ƒå®‰è£…ä¾èµ–å¹¶ç¼–è¯‘
          image: $DOCKER_CACHE_IMAGE_NAME
          script: |
            ln -snf $NODE_PATH node_modules
            time npm install
            sed -i 's@http://localhost:8888/@/@g' .env.production
            time yarn build:prod
        - name: ğŸ“¦ æ„å»ºåˆ¶å“
          image: docker.cnb.cool/znb/images/debian
          script: |
            zip -q -r dist.zip dist
            openssl md5 dist.zip > dist.zip.md5
        - name: ğŸ‹ æ¨é€åˆ¶å“
          image: cnbcool/attachments:latest
          settings:
            attachments:
              - dist.zip
              - dist.zip.md5